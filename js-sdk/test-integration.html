<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>模块化 SDK 集成测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #f6ffed; border: 1px solid #b7eb8f; color: #52c41a; }
        .error { background: #fff2f0; border: 1px solid #ffccc7; color: #ff4d4f; }
        .info { background: #e6f7ff; border: 1px solid #91d5ff; color: #1890ff; }
        button {
            padding: 10px 20px;
            background: #1890ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #40a9ff; }
        .log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>模块化 SDK 集成测试</h1>
        
        <div id="status" class="status info">
            正在初始化 SDK...
        </div>

        <div>
            <button onclick="testFetch()">测试 Fetch</button>
            <button onclick="testXHR()">测试 XHR</button>
            <button onclick="getLogs()">获取日志</button>
            <button onclick="clearLogs()">清空日志</button>
        </div>

        <div id="logs" class="log">
            日志将显示在这里...
        </div>
    </div>

    <script type="module">
        let sdk = null;
        const statusEl = document.getElementById('status');
        const logsEl = document.getElementById('logs');

        function updateStatus(message, type = 'info') {
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function addLog(message) {
            const time = new Date().toLocaleTimeString();
            logsEl.innerHTML += `[${time}] ${message}\n`;
            logsEl.scrollTop = logsEl.scrollHeight;
        }

        async function initSDK() {
            try {
                updateStatus('正在导入模块...', 'info');
                
                // 动态导入模块化 SDK
                const { ApolloSecurityTester } = await import('./src/index.js');
                addLog('✓ 模块导入成功');
                
                updateStatus('正在初始化 SDK...', 'info');
                
                sdk = new ApolloSecurityTester({
                    autoStart: true,
                    position: 'bottom-right'
                });
                
                sdk.init();
                addLog('✓ SDK 初始化成功');
                
                updateStatus('SDK 初始化成功！', 'success');
                addLog('✓ 调试面板已启动，请查看右下角');
                
            } catch (error) {
                updateStatus('SDK 初始化失败: ' + error.message, 'error');
                addLog('✗ 初始化失败: ' + error.message);
                addLog('错误详情: ' + error.stack);
            }
        }

        // 暴露测试函数到全局
        window.testFetch = async function() {
            try {
                addLog('发送 Fetch 请求...');
                const response = await fetch('https://jsonplaceholder.typicode.com/todos/1');
                const data = await response.json();
                addLog('✓ Fetch 请求成功: ' + JSON.stringify(data).substring(0, 100) + '...');
            } catch (error) {
                addLog('✗ Fetch 请求失败: ' + error.message);
            }
        };

        window.testXHR = function() {
            try {
                addLog('发送 XHR 请求...');
                const xhr = new XMLHttpRequest();
                xhr.open('GET', 'https://jsonplaceholder.typicode.com/users');
                xhr.onload = () => {
                    addLog('✓ XHR 请求成功: ' + xhr.responseText.substring(0, 100) + '...');
                };
                xhr.onerror = () => {
                    addLog('✗ XHR 请求失败');
                };
                xhr.send();
            } catch (error) {
                addLog('✗ XHR 请求失败: ' + error.message);
            }
        };

        window.getLogs = function() {
            if (sdk) {
                const logs = sdk.getNetworkLogs();
                addLog('网络日志数量: ' + logs.length);
                logs.forEach((log, index) => {
                    addLog(`日志 ${index + 1}: ${log.method} ${log.url} - ${log.status} (${log.timeMs}ms)`);
                });
            } else {
                addLog('SDK 未初始化');
            }
        };

        window.clearLogs = function() {
            if (sdk) {
                sdk.clearNetworkLogs();
                addLog('✓ 网络日志已清空');
            } else {
                addLog('SDK 未初始化');
            }
        };

        // 页面加载后初始化
        initSDK();
    </script>
</body>
</html>
